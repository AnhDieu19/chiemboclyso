# HUYá»€N KHÃ”NG PHI TINH - PHÃI LÃ KHÃ
## TÃ i liá»‡u nghiÃªn cá»©u vÃ  phÃ¡t triá»ƒn tÃ­nh nÄƒng

---

## 1. Tá»”NG QUAN

### 1.1. Äá»‹nh nghÄ©a
**Huyá»n KhÃ´ng Phi Tinh** (ç„ç©ºé£›æ˜Ÿ) lÃ  má»™t phÆ°Æ¡ng phÃ¡p an sao Ä‘áº·c biá»‡t trong Tá»­ Vi Äáº©u Sá»‘, thuá»™c phÃ¡i LÃ­ KhÃ­ (ç†æ°£æ´¾). PhÆ°Æ¡ng phÃ¡p nÃ y dá»±a trÃªn:
- NguyÃªn lÃ½ Huyá»n KhÃ´ng Phong Thá»§y
- Chu ká»³ thá»i gian (NguyÃªn Váº­n, Äáº¡i Váº­n)
- Sá»± chuyá»ƒn hÃ³a cá»§a NgÅ© HÃ nh theo khÃ´ng gian vÃ  thá»i gian

### 1.2. Äáº·c Ä‘iá»ƒm
- **Phi Tinh** (Flying Stars): CÃ¡c sao "bay" theo quy luáº­t nháº¥t Ä‘á»‹nh qua 12 cung
- **Huyá»n KhÃ´ng**: NguyÃªn lÃ½ khÃ´ng gian - thá»i gian trong Dá»‹ch há»c
- **LÃ­ KhÃ­**: Thuá»™c phÃ¡i nghiÃªn cá»©u vá» khÃ­ (æ°£) vÃ  lÃ½ (ç†)

### 1.3. Quan há»‡ vá»›i PhÃ¡i Loan Äáº§u (å³¦å¤´æ´¾)

**PhÃ¡i LÃ­ KhÃ­ vs PhÃ¡i Loan Äáº§u:**

| Äáº·c Ä‘iá»ƒm | PhÃ¡i LÃ­ KhÃ­ (ç†æ°£æ´¾) | PhÃ¡i Loan Äáº§u (å³¦å¤´æ´¾) |
|----------|---------------------|----------------------|
| Trá»ng tÃ¢m | Thá»i gian, KhÃ­ váº­n | KhÃ´ng gian, HÃ¬nh tháº¿ |
| PhÆ°Æ¡ng phÃ¡p | TÃ­nh toÃ¡n theo chu ká»³ | Quan sÃ¡t hÃ¬nh Ä‘á»‹a lÃ½ |
| á»¨ng dá»¥ng | Phi Tinh, Váº­n Tinh | Äá»‹a tháº¿, Cá»¥c diá»‡n |
| CÃ´ng cá»¥ | Láº¡c ThÆ°, HÃ  Äá»“ | La BÃ n, BÃ¡t QuÃ¡i |

**TÃ­ch há»£p LÃ­ KhÃ­ + Loan Äáº§u trong Tá»­ Vi:**
- **LÃ­ KhÃ­ (Phi Tinh)**: XÃ¡c Ä‘á»‹nh thá»i Ä‘iá»ƒm cÃ¡tí‰ â†’ Khi nÃ o tá»‘t/xáº¥u
- **Loan Äáº§u (12 Cung)**: XÃ¡c Ä‘á»‹nh khÃ´ng gian cÃ¡tí‰ â†’ Cung nÃ o tá»‘t/xáº¥u
- **Káº¿t há»£p**: Phi Tinh bay vÃ o cÃ¡c Cung â†’ Thá»i gian + KhÃ´ng gian = Dá»± Ä‘oÃ¡n chÃ­nh xÃ¡c

**VÃ­ dá»¥ tÃ­ch há»£p:**
```
Cung Má»‡nh (Loan Äáº§u) + BÃ¡t Báº¡ch Tinh (LÃ­ KhÃ­) + NÄƒm 2024 (Váº­n 9)
â†’ PhÃ¢n tÃ­ch: Má»‡nh cung gáº·p BÃ¡t Báº¡ch (CÃ¡t tinh) trong Váº­n 9
â†’ Ã nghÄ©a: TÃ i váº­n hanh thÃ´ng, sá»± nghiá»‡p thÄƒng tiáº¿n
```

### 1.4. Láº¡c ThÆ°: TiÃªn ThiÃªn hay Háº­u ThiÃªn?

**Huyá»n KhÃ´ng Phi Tinh sá»­ dá»¥ng Láº C THÆ¯ Háº¬U THIÃŠN (å¾Œå¤©æ´›æ›¸)**

#### So sÃ¡nh Láº¡c ThÆ° TiÃªn ThiÃªn vs Háº­u ThiÃªn:

**1. Láº¡c ThÆ° TiÃªn ThiÃªn (å…ˆå¤©æ´›æ›¸) - HÃ  Äá»“:**
```
Thá»© tá»±: Theo HÃ  Äá»“
   1(N)  6
   8     5(Center)
   3     4
   2(S)  7

Äáº·c Ä‘iá»ƒm:
- TÄ©nh, báº¥t biáº¿n
- NguyÃªn lÃ½ vÅ© trá»¥ ban Ä‘áº§u
- DÃ¹ng trong phong thá»§y cá»• truyá»n
```

**2. Láº¡c ThÆ° Háº­u ThiÃªn (å¾Œå¤©æ´›æ›¸) - DÃ¹ng trong Phi Tinh:** âœ…
```
Thá»© tá»±: Theo Láº¡c ThÆ°
   4(SE)  9(S)   2(SW)
   3(E)   5      7(W)
   8(NE)  1(N)   6(NW)

Äáº·c Ä‘iá»ƒm:
- Äá»™ng, biáº¿n Ä‘á»•i theo thá»i gian
- NguyÃªn lÃ½ háº­u thiÃªn váº¡n váº­t
- DÃ¹ng trong Huyá»n KhÃ´ng Phi Tinh
- Chu ká»³ 180 nÄƒm (9 Váº­n x 20 nÄƒm)
```

#### So sÃ¡nh Láº¡c ThÆ° cÃ¡c há»‡ thá»‘ng:

**A. Láº¡c ThÆ° Trung Hoa (Háº­u ThiÃªn) - Chuáº©n quá»‘c táº¿:**
```
   4  9  2
   3  5  7
   8  1  6

Ãnh xáº¡ BÃ¡t QuÃ¡i:
- 1 = Kháº£m (å) = Báº¯c = Thá»§y
- 2 = KhÃ´n (å¤) = TÃ¢y Nam = Thá»•
- 3 = Cháº¥n (éœ‡) = ÄÃ´ng = Má»™c
- 4 = Tá»‘n (å·½) = ÄÃ´ng Nam = Má»™c
- 5 = Trung Cung = Trung tÃ¢m = Thá»•
- 6 = CÃ n (ä¹¾) = TÃ¢y Báº¯c = Kim
- 7 = ÄoÃ i (å…Œ) = TÃ¢y = Kim
- 8 = Cáº¥n (è‰®) = ÄÃ´ng Báº¯c = Thá»•
- 9 = Ly (é›¢) = Nam = Há»a
```

**B. Láº¡c ThÆ° Láº¡c Viá»‡t (Náº¿u cÃ³ biáº¿n thá»ƒ):**
```
â€» LÆ°u Ã½: Há»‡ thá»‘ng Láº¡c Viá»‡t cáº§n nghiÃªn cá»©u thÃªm

CÃ³ thá»ƒ khÃ¡c biá»‡t:
1. Äiá»ƒm xuáº¥t phÃ¡t (Báº¯c vs ÄÃ´ng)
2. Chiá»u phi tinh (Thuáº­n vs Nghá»‹ch)
3. Ãnh xáº¡ vá»›i 12 Chi (TÃ½, Sá»­u...)

Cáº§n xÃ¡c minh:
- CÃ³ tÃ i liá»‡u Láº¡c Viá»‡t chÃ­nh thá»‘ng khÃ´ng?
- CÃ³ dÃ¹ng 12 Chi thay 8 QuÃ¡i khÃ´ng?
- CÃ³ Ä‘iá»u chá»‰nh cho mÃºi giá» VN khÃ´ng?
```

**C. CÃ´ng thá»©c chuyá»ƒn Ä‘á»•i HÃ  Äá»“ â†’ Láº¡c ThÆ° (Theo ViÃªn NhÆ°):**

Tham kháº£o: [NghiÃªn Cá»©u Lá»‹ch Sá»­ - CÃ´ng thá»©c tÃ­nh HÃ  Äá»“ thÃ nh Láº¡c ThÆ°](https://nghiencuulichsu.com/2019/02/13/cong-thuc-tinh-ha-do-thanh-lac-thu/)

```python
"""
HÃ  Äá»“ (æ²³åœ–) = Báº£n thá»ƒ vÅ© trá»¥ (TiÃªn ThiÃªn BÃ¡t QuÃ¡i)
Láº¡c ThÆ° (æ´›æ›¸) = Tháº¿ giá»›i hiá»‡n tÆ°á»£ng (Háº­u ThiÃªn BÃ¡t QuÃ¡i)

CÃ´ng thá»©c: 1â†’4â†’3â†’2â†’1 (theo tÆ°Æ¡ng tÃ¡c Ã‚m-DÆ°Æ¡ng)
"""

# 1. TÆ°Æ¡ng tÃ¡c Tung â†” Há»¯u (xoay 180Â°)
Tung 1 (CÃ n-KhÃ´n, DÆ°Æ¡ng) â†” Há»¯u 4 (Tá»‘n-Cáº¥n, Ã‚m)
â†’ Há»¯u 4: KhÃ´n-CÃ n (Ã‚m)

# 2. TÆ°Æ¡ng tÃ¡c Há»¯u â†” Táº£ (xoay 360Â°)
Há»¯u 4 (Tá»‘n-Cáº¥n, Ã‚m) â†” Táº£ 3 (ÄoÃ i-Cháº¥n, DÆ°Æ¡ng)
â†’ Táº£ 3: Cáº¥n-Tá»‘n (DÆ°Æ¡ng)

# 3. TÆ°Æ¡ng tÃ¡c Táº£ â†” HoÃ nh (xoay 90Â°)
Táº£ 3 (ÄoÃ i-Cháº¥n, DÆ°Æ¡ng) â†” HoÃ nh 2 (Kháº£m-Ly, Ã‚m)
â†’ HoÃ nh 2: Cháº¥n-ÄoÃ i (Ã‚m)

# 4. TÆ°Æ¡ng tÃ¡c HoÃ nh â†” Tung (xoay 90Â°)
HoÃ nh 2 (Kháº£m-Ly, Ã‚m) â†” Tung 1 (CÃ n-KhÃ´n, DÆ°Æ¡ng)
â†’ Tung 1: Kháº£m-Ly (DÆ°Æ¡ng)

# Káº¿t quáº£ Láº¡c ThÆ°:
#   4  9  2
#   3  5  7
#   8  1  6

# LÃ½ sá»‘:
- Tung (DÆ°Æ¡ng): Láº¥y sá»‘ DÆ°Æ¡ng 2-7 tá»« HÃ  Äá»“
- HoÃ nh (Ã‚m): Láº¥y sá»‘ Ã‚m 4-9 tá»« HÃ  Äá»“
- Trung tÃ¢m: 5 (10 Ä‘Ã£ hÃ²a vÃ o cÃ¡c cáº·p Ä‘á»‘i diá»‡n)
```

**Ã nghÄ©a:**
- **HÃ  Äá»“**: Báº£n thá»ƒ, khÃ´ng gian, tÄ©nh, "thá»ƒ viÃªn nhi dá»¥ng phÆ°Æ¡ng" (é«”åœ“è€Œç”¨æ–¹)
- **Láº¡c ThÆ°**: Hiá»‡n tÆ°á»£ng, thá»i gian, Ä‘á»™ng, "thá»ƒ phÆ°Æ¡ng nhi dá»¥ng viÃªn" (é«”æ–¹è€Œç”¨åœ“)
- **Huyá»n KhÃ´ng Phi Tinh** dÃ¹ng Láº¡c ThÆ° vÃ¬ cÃ³ yáº¿u tá»‘ **thá»i gian** (Váº­n 20 nÄƒm, LÆ°u NiÃªn hÃ ng nÄƒm)
- **Tá»­ Vi Äáº©u Sá»‘** dÃ¹ng 12 Cung cá»‘ Ä‘á»‹nh, khÃ´ng dÃ¹ng Láº¡c ThÆ° (khÃ´ng cÃ³ khÃ¡i niá»‡m phi tinh theo thá»i gian)

**âš ï¸ LÆ°u Ã½:**
```
CÃ´ng thá»©c ViÃªn NhÆ° chá»©ng minh Láº¡c ThÆ° khÃ´ng pháº£i "tÃ¹y tiá»‡n sáº¯p xáº¿p"
mÃ  lÃ  káº¿t quáº£ tÆ°Æ¡ng tÃ¡c Ã‚m-DÆ°Æ¡ng giá»¯a cÃ¡c trá»¥c.

Tuy nhiÃªn, Ä‘Ã¢y lÃ  nghiÃªn cá»©u lá»‹ch sá»­, chÆ°a cÃ³ consensus há»c thuáº­t.
Cáº§n xem nhÆ° tÃ i liá»‡u tham kháº£o, khÃ´ng pháº£i chÃ¢n lÃ½ tuyá»‡t Ä‘á»‘i.
```

---

## 2. CÃC LOáº I SAO HUYá»€N KHÃ”NG PHI TINH

### 2.1. Cá»­u Tinh (ä¹æ˜Ÿ - 9 Sao chÃ­nh)
Dá»±a trÃªn Láº¡c ThÆ° vÃ  HÃ  Äá»“:

| STT | TÃªn sao | NgÅ© HÃ nh | Ã nghÄ©a | CÃ¡t/í‰ |
|-----|---------|----------|---------|--------|
| 1 | Nháº¥t Báº¡ch (ä¸€ç™½) | Thá»§y | Tham Lang | CÃ¡t |
| 2 | Nhá»‹ Háº¯c (äºŒé»‘) | Thá»• | Cá»± MÃ´n | Hung |
| 3 | Tam BÃ­ch (ä¸‰ç¢§) | Má»™c | Lá»™c Tá»“n | Hung |
| 4 | Tá»© Lá»¥c (å››ç¶ ) | Má»™c | VÄƒn KhÃºc | CÃ¡t |
| 5 | NgÅ© HoÃ ng (äº”é»ƒ) | Thá»• | LiÃªm Trinh | Hung |
| 6 | Lá»¥c Báº¡ch (å…­ç™½) | Kim | VÅ© KhÃºc | CÃ¡t |
| 7 | Tháº¥t XÃ­ch (ä¸ƒèµ¤) | Kim | PhÃ¡ QuÃ¢n | Hung |
| 8 | BÃ¡t Báº¡ch (å…«ç™½) | Thá»• | Táº£ PhÃ¹ | CÃ¡t |
| 9 | Cá»­u Tá»­ (ä¹ç´«) | Há»a | Há»¯u Báº­t | CÃ¡t |

### 2.2. Äáº·c tÃ­nh cÃ¡c sao
- **CÃ¡t tinh**: 1, 4, 6, 8, 9
- **Hung tinh**: 2, 3, 5, 7
- **NgÅ© HoÃ ng (5)**: Hung tinh máº¡nh nháº¥t, tÆ°á»£ng trÆ°ng tai há»a

---

## 3. NGUYÃŠN LÃ AN SAO

### 3.1. NguyÃªn Váº­n (å…ƒé‹)
Chu ká»³ 180 nÄƒm chia thÃ nh 3 NguyÃªn, má»—i NguyÃªn 60 nÄƒm:
- **ThÆ°á»£ng NguyÃªn** (ä¸Šå…ƒ): Váº­n 1-2-3 (1864-1923)
- **Trung NguyÃªn** (ä¸­å…ƒ): Váº­n 4-5-6 (1924-1983)
- **Háº¡ NguyÃªn** (ä¸‹å…ƒ): Váº­n 7-8-9 (1984-2043)

### 3.2. Äáº¡i Váº­n (å¤§é‹)
Má»—i Váº­n kÃ©o dÃ i 20 nÄƒm:
- Váº­n 1: 1864-1883
- Váº­n 2: 1884-1903
- Váº­n 3: 1904-1923
- Váº­n 4: 1924-1943
- Váº­n 5: 1944-1963
- Váº­n 6: 1964-1983
- Váº­n 7: 1984-2003
- **Váº­n 8**: 2004-2023
- **Váº­n 9**: 2024-2043 â† Hiá»‡n táº¡i

### 3.2bis. LÆ°u NiÃªn, LÆ°u Nguyá»‡t, LÆ°u Nháº­t, LÆ°u ThÃ¬

**CÃ¡c táº§ng Phi Tinh theo thá»i gian:**

#### A. LÆ°u NiÃªn (æµå¹´ - Yearly Flying Stars)
```python
def get_yearly_star(base_year=2024):
    """
    LÆ°u NiÃªn: Phi tinh theo nÄƒm
    CÃ´ng thá»©c: (NÄƒm hiá»‡n táº¡i - NÄƒm gá»‘c) mod 9 + 1
    """
    base_star = 9  # Váº­n 9 (2024-2043)
    current_year = datetime.now().year
    offset = (current_year - base_year) % 9
    yearly_star = (base_star + offset - 1) % 9 + 1
    return yearly_star

# VÃ­ dá»¥:
# 2024 â†’ Sao 9 (Váº­n 9)
# 2025 â†’ Sao 1 (9+1=10, 10%9=1)
# 2026 â†’ Sao 2
# ...
```

#### B. LÆ°u Nguyá»‡t (æµæœˆ - Monthly Flying Stars)
```python
def get_monthly_star(year, month):
    """
    LÆ°u Nguyá»‡t: Phi tinh theo thÃ¡ng
    
    CÃ´ng thá»©c dá»±a theo Tiáº¿t KhÃ­:
    - ThÃ¡ng 1 (Dáº§n): Láº­p XuÃ¢n â†’ Kinh Tráº­p
    - ThÃ¡ng 2 (MÃ£o): Kinh Tráº­p â†’ Thanh Minh
    - ...
    
    LÆ°u Nguyá»‡t Tinh = (LÆ°u NiÃªn Tinh + ThÃ¡ng - 1) mod 9
    """
    yearly_star = get_yearly_star(year)
    
    # ThÃ¡ng 1 = Dáº§n, ThÃ¡ng 2 = MÃ£o, ...
    # Cáº§n convert tá»« thÃ¡ng dÆ°Æ¡ng lá»‹ch sang thÃ¡ng Can Chi
    lunar_month = convert_to_lunar_month(year, month)
    
    monthly_star = (yearly_star + lunar_month - 1) % 9
    if monthly_star == 0:
        monthly_star = 9
    
    return monthly_star
```

#### C. LÆ°u Nháº­t (æµæ—¥ - Daily Flying Stars) âš ï¸ Phá»©c táº¡p
```python
def get_daily_star(year, month, day):
    """
    LÆ°u Nháº­t: Phi tinh theo ngÃ y
    
    Cá»±c ká»³ phá»©c táº¡p, cáº§n:
    1. TÃ­nh Can Chi cá»§a ngÃ y (GiÃ¡p TÃ½, áº¤t Sá»­u...)
    2. XÃ¡c Ä‘á»‹nh Tiáº¿t KhÃ­
    3. Phi tinh tá»« LÆ°u Nguyá»‡t
    
    CÃ´ng thá»©c:
    - NgÃ y 1 cá»§a thÃ¡ng = LÆ°u Nguyá»‡t Tinh
    - CÃ¡c ngÃ y sau: Phi theo thá»© tá»± Láº¡c ThÆ°
    
    âš ï¸ Warning: 
    - Ráº¥t phá»©c táº¡p, dá»… sai
    - Ãt Ä‘Æ°á»£c dÃ¹ng trong thá»±c táº¿
    - Khuyáº¿n nghá»‹: KhÃ´ng implement giai Ä‘oáº¡n Ä‘áº§u
    """
    monthly_star = get_monthly_star(year, month)
    
    # Simplified version (cÃ³ thá»ƒ khÃ´ng chÃ­nh xÃ¡c 100%)
    day_offset = day % 9
    daily_star = (monthly_star + day_offset - 1) % 9
    if daily_star == 0:
        daily_star = 9
    
    return daily_star
```

#### D. LÆ°u ThÃ¬ (æµæ—¶ - Hourly Flying Stars) âš ï¸âš ï¸ Cá»±c phá»©c táº¡p
```python
def get_hourly_star(year, month, day, hour):
    """
    LÆ°u ThÃ¬: Phi tinh theo giá» (12 Giá» Tháº§n)
    
    Cá»±c ká»³ phá»©c táº¡p:
    - Cáº§n Can Chi chÃ­nh xÃ¡c cá»§a ngÃ y
    - Phi tá»« LÆ°u Nháº­t Tinh
    - Dá»±a vÃ o 12 Äá»‹a Chi (TÃ½, Sá»­u, Dáº§n...)
    
    âš ï¸âš ï¸ Extreme Warning:
    - Äá»™ chÃ­nh xÃ¡c tháº¥p náº¿u khÃ´ng cÃ³ cÃ´ng thá»©c chuáº©n
    - Ráº¥t Ã­t sÃ¡ch viáº¿t vá» LÆ°u ThÃ¬
    - Khuyáº¿n nghá»‹: KHÃ”NG implement
    """
    daily_star = get_daily_star(year, month, day)
    
    # Hour: 0-23 â†’ Chi: 0-11 (TÃ½-Há»£i)
    chi_index = (hour // 2) % 12
    
    hourly_star = (daily_star + chi_index) % 9
    if hourly_star == 0:
        hourly_star = 9
    
    return hourly_star
```

#### Khuyáº¿n nghá»‹ Implementation:
```python
# Phase 1: âœ… Implement
- Váº­n Tinh (20 nÄƒm)
- LÆ°u NiÃªn (hÃ ng nÄƒm)

# Phase 2: âš ï¸ Optional
- LÆ°u Nguyá»‡t (hÃ ng thÃ¡ng)

# Phase 3: âŒ KhÃ´ng khuyáº¿n nghá»‹
- LÆ°u Nháº­t (quÃ¡ phá»©c táº¡p, Ã­t dÃ¹ng)
- LÆ°u ThÃ¬ (cá»±c phá»©c táº¡p, gáº§n nhÆ° khÃ´ng dÃ¹ng)
```

### 3.3. Quy luáº­t phi tinh
```
Sá»‘ Váº­n hiá»‡n táº¡i â†’ Vá»‹ trÃ­ trung tÃ¢m
â””â”€â†’ CÃ¡c sao khÃ¡c bay theo thá»© tá»± Láº¡c ThÆ°
    Thuáº­n phi (é †é£›): 1â†’2â†’3â†’4â†’5â†’6â†’7â†’8â†’9â†’1
    Nghá»‹ch phi (é€†é£›): 9â†’8â†’7â†’6â†’5â†’4â†’3â†’2â†’1â†’9
```

---

## 4. CÃCH TÃNH VÃ€ AN SAO

### 4.0. Táº­n dá»¥ng code Tá»­ Vi hiá»‡n cÃ³

**âœ… CÃ¡c hÃ m cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng:**

```python
# Tá»« python/core/calendar_converter.py
from core.calendar_converter import CalendarConverter

# 1. Chuyá»ƒn Ä‘á»•i lá»‹ch Ã‚m-DÆ°Æ¡ng
converter = CalendarConverter()
lunar_date = converter.solar_to_lunar(2024, 1, 15)
# â†’ Tráº£ vá»: (lunar_year, lunar_month, lunar_day, is_leap)

# 2. TÃ­nh Can Chi cá»§a nÄƒm, thÃ¡ng, ngÃ y
from core.can_chi import calculate_can_chi
can_chi_data = calculate_can_chi(2024, 1, 15, 12)
# â†’ Tráº£ vá»: {
#     'year_can': 'GiÃ¡p', 'year_chi': 'ThÃ¬n',
#     'month_can': 'BÃ­nh', 'month_chi': 'Dáº§n',
#     'day_can': 'NhÃ¢n', 'day_chi': 'TÃ½',
#     'hour_chi': 'Ngá»'
# }

# 3. TÃ­nh vá»‹ trÃ­ 12 cung
from logic.cung_calculator import CungCalculator
cung_calc = CungCalculator(lunar_month, hour_chi_index)
menh_cung = cung_calc.calculate_cung_positions()
# â†’ Tráº£ vá»: {'Menh': 0, 'Phu_The': 1, 'Phuc_Duc': 2, ...}

# 4. NgÅ© HÃ nh tÆ°Æ¡ng sinh/tÆ°Æ¡ng kháº¯c
from logic.ngu_hanh_engine import NguHanhEngine
relation = NguHanhEngine.get_relation('Má»™c', 'Thá»•')
# â†’ Tráº£ vá»: 'khac' hoáº·c 'sinh' hoáº·c 'neutral'

# 5. Ãnh xáº¡ tÃªn sao (cÃ³ dáº¥u â†” khÃ´ng dáº¥u)
from graph.static.js.star_mapping import STAR_NAME_MAP
normalized = normalize_star_name('ThÃ¡i Ã‚m')
# â†’ Tráº£ vá»: 'thai_am'
```

**âŒ CÃ¡c hÃ m cáº§n viáº¿t má»›i:**

```python
# 1. XÃ¡c Ä‘á»‹nh Váº­n (20 nÄƒm)
def get_current_yun(year):
    """ChÆ°a cÃ³ trong Tá»­ Vi, cáº§n viáº¿t má»›i"""
    pass

# 2. Ãnh xáº¡ Láº¡c ThÆ° â†’ 12 Cung
def map_luo_shu_to_12_cung():
    """
    Huyá»n KhÃ´ng: 9 sá»‘ Láº¡c ThÆ° â†’ 12 Cung
    Tá»­ Vi: 12 Cung cá»‘ Ä‘á»‹nh
    â†’ Cáº§n xÃ¡c Ä‘á»‹nh logic Ã¡nh xáº¡
    """
    pass

# 3. Thuáº­t toÃ¡n phi tinh (thuáº­n/nghá»‹ch)
def fly_stars_algorithm(center_star, direction='forward'):
    """
    Láº¡c ThÆ° phi tinh theo thá»© tá»± 1â†’2â†’3...â†’9
    KhÃ¡c vá»›i Tá»­ Vi (khÃ´ng cÃ³ khÃ¡i niá»‡m nÃ y)
    """
    pass

# 4. TÃ­nh LÆ°u NiÃªn, LÆ°u Nguyá»‡t (náº¿u implement)
def get_yearly_star(base_year, current_year):
    """Phi tinh hÃ ng nÄƒm, chÆ°a cÃ³ trong Tá»­ Vi"""
    pass
```

**ğŸ“Š Æ¯á»›c lÆ°á»£ng:**
- **Code tÃ¡i sá»­ dá»¥ng**: ~70% (calendar, can chi, cung, ngÅ© hÃ nh)
- **Code má»›i**: ~30% (váº­n, phi tinh, láº¡c thÆ° mapping)
- **Thá»i gian tiáº¿t kiá»‡m**: ~40% nhá» táº­n dá»¥ng core Tá»­ Vi

**âš ï¸ LÆ°u Ã½:**
```python
# Tá»­ Vi cÃ³ 12 Cung cá»‘ Ä‘á»‹nh:
CHI_NAMES = ['TÃ½', 'Sá»­u', 'Dáº§n', 'MÃ£o', 'ThÃ¬n', 'Tá»µ', 
             'Ngá»', 'MÃ¹i', 'ThÃ¢n', 'Dáº­u', 'Tuáº¥t', 'Há»£i']

# Huyá»n KhÃ´ng cÃ³ 9 Sao + 8 QuÃ¡i:
FLYING_STARS = [1, 2, 3, 4, 5, 6, 7, 8, 9]
BA_QUAT = ['Kháº£m', 'KhÃ´n', 'Cháº¥n', 'Tá»‘n', 'CÃ n', 'ÄoÃ i', 'Cáº¥n', 'Ly']

# â†’ Cáº§n mapping 9 sao vÃ o 12 cung (cÃ³ 3 cung trÃ¹ng)
```

### 4.1. XÃ¡c Ä‘á»‹nh Váº­n hiá»‡n táº¡i
```python
def get_current_yun(year):
    """
    XÃ¡c Ä‘á»‹nh Váº­n dá»±a vÃ o nÄƒm
    2024-2043: Váº­n 9
    """
    if 1864 <= year <= 1883: return 1
    elif 1884 <= year <= 1903: return 2
    elif 1904 <= year <= 1923: return 3
    elif 1924 <= year <= 1943: return 4
    elif 1944 <= year <= 1963: return 5
    elif 1964 <= year <= 1983: return 6
    elif 1984 <= year <= 2003: return 7
    elif 2004 <= year <= 2023: return 8
    elif 2024 <= year <= 2043: return 9
    else: return None
```

### 4.2. Thá»© tá»± phi tinh theo Láº¡c ThÆ°
```
Cung vá»‹ trÃ­ theo Láº¡c ThÆ°:
   4  9  2
   3  5  7
   8  1  6
```

Ãnh xáº¡ sang 12 cung Tá»­ Vi:
```
Dáº§n(4) - MÃ£o(9) - ThÃ¬n(2)
Sá»­u(3) - [5]    - Tá»µ(7)
TÃ½(8)  - Há»£i(1) - Ngá»(6)
```

### 4.3. Algorithm an sao cÆ¡ báº£n
```python
def an_huyen_khong_phi_tinh(year, month, day, hour, menh_cung_position):
    """
    An Huyá»n KhÃ´ng Phi Tinh vÃ o 12 cung
    
    Input:
        - year: NÄƒm sinh
        - month: ThÃ¡ng sinh
        - day: NgÃ y sinh
        - hour: Giá» sinh
        - menh_cung_position: Vá»‹ trÃ­ cung Má»‡nh (0-11)
    
    Output:
        - Dictionary: {cung_position: [list_of_stars]}
    """
    
    # 1. XÃ¡c Ä‘á»‹nh Váº­n hiá»‡n táº¡i
    yun = get_current_yun(year)
    
    # 2. XÃ¡c Ä‘á»‹nh sao trung tÃ¢m (Váº­n Tinh)
    center_star = yun
    
    # 3. An sao theo Láº¡c ThÆ° (thuáº­n phi hoáº·c nghá»‹ch phi)
    # Dá»±a vÃ o Ã‚m/DÆ°Æ¡ng cá»§a nÄƒm vÃ  Má»‡nh cung
    is_yang_year = is_yang_year(year)
    
    # 4. Phi tinh tá»« trung tÃ¢m ra 8 cung
    star_positions = fly_stars(center_star, is_yang_year)
    
    # 5. TÃ­nh sao ThÃ¡i Tuáº¿ (æµå¹´é£›æ˜Ÿ)
    yearly_stars = fly_yearly_stars(year, star_positions)
    
    # 6. TÃ­nh sao ThÃ¡ng (æµæœˆé£›æ˜Ÿ)
    monthly_stars = fly_monthly_stars(month, star_positions)
    
    return {
        'base_stars': star_positions,
        'yearly_stars': yearly_stars,
        'monthly_stars': monthly_stars
    }
```

### 4.4. Thuáº­n phi vs Nghá»‹ch phi
```python
def fly_stars(center_star, is_yang):
    """
    Phi tinh tá»« trung tÃ¢m theo Láº¡c ThÆ°
    
    Thuáº­n phi (Yang): 1â†’2â†’3â†’4â†’5â†’6â†’7â†’8â†’9
    Nghá»‹ch phi (Ã‚m): 9â†’8â†’7â†’6â†’5â†’4â†’3â†’2â†’1
    """
    luo_shu_positions = [
        (1, 'Há»£i'),  # Kháº£m - Báº¯c
        (2, 'ThÃ¬n'), # KhÃ´n - TÃ¢y Nam
        (3, 'Sá»­u'),  # Cháº¥n - ÄÃ´ng
        (4, 'Dáº§n'),  # Tá»‘n - ÄÃ´ng Nam
        (5, None),   # Trung tÃ¢m - khÃ´ng cÃ³ cung
        (6, 'Ngá»'),  # CÃ n - TÃ¢y Báº¯c
        (7, 'Tá»µ'),   # ÄoÃ i - TÃ¢y
        (8, 'TÃ½'),   # Cáº¥n - ÄÃ´ng Báº¯c
        (9, 'MÃ£o')   # Ly - Nam
    ]
    
    result = {}
    
    for i, (pos, cung_name) in enumerate(luo_shu_positions):
        if pos == 5:
            continue  # Skip center
            
        if is_yang:
            star_number = (center_star + i - 1) % 9 + 1
        else:
            star_number = (center_star - i + 1) % 9
            if star_number == 0:
                star_number = 9
        
        result[cung_name] = star_number
    
    return result
```

---

## 5. TÆ¯Æ NG SINH TÆ¯Æ NG KHáº®C

### 5.1. Quan há»‡ NgÅ© HÃ nh giá»¯a cÃ¡c sao
```
Sinh (CÃ¡t):
- Thá»§y sinh Má»™c: 1 + 3,4
- Má»™c sinh Há»a: 3,4 + 9
- Há»a sinh Thá»•: 9 + 2,5,8
- Thá»• sinh Kim: 2,5,8 + 6,7
- Kim sinh Thá»§y: 6,7 + 1

Kháº¯c (Hung):
- Kim kháº¯c Má»™c: 6,7 kháº¯c 3,4
- Má»™c kháº¯c Thá»•: 3,4 kháº¯c 2,5,8
- Thá»• kháº¯c Thá»§y: 2,5,8 kháº¯c 1
- Thá»§y kháº¯c Há»a: 1 kháº¯c 9
- Há»a kháº¯c Kim: 9 kháº¯c 6,7
```

### 5.2. Tá»• há»£p Ä‘áº·c biá»‡t
- **1-4 Äá»“ng cung**: VÄƒn XÆ°Æ¡ng VÄƒn KhÃºc há»™i, CÃ¡t vá» vÄƒn chÆ°Æ¡ng
- **2-5 Äá»“ng cung**: Bá»‡nh PhÃ¹ há»™i, Hung vá» bá»‡nh táº­t
- **6-7 Äá»“ng cung**: Kim Kim tranh Ä‘áº¥u, hung vá» quan tai
- **8-9 Äá»“ng cung**: TÃ i vÆ°á»£ng, CÃ¡t vá» tÃ i lá»™c

---

## 6. THIáº¾T Káº¾ Há»† THá»NG

### 6.1. Data Model
```python
class HuyenKhongPhiTinh:
    """
    Model lÆ°u trá»¯ thÃ´ng tin Huyá»n KhÃ´ng Phi Tinh
    """
    star_number: int  # 1-9
    star_name: str    # Nháº¥t Báº¡ch, Nhá»‹ Háº¯c, ...
    ngu_hanh: str     # Thá»§y, Má»™c, Há»a, Thá»•, Kim
    nature: str       # cat/hung
    position: int     # 0-11 (12 cung)
    star_type: str    # base/yearly/monthly/daily/hourly
```

### 6.2. API Endpoints
```python
# 1. Calculate Huyá»n KhÃ´ng Phi Tinh
POST /api/huyen-khong/calculate
Body: {
    "year": 1994,
    "month": 3,
    "day": 28,
    "hour": 0,  # Giá» TÃ½
    "gender": "nam",
    "calendar": "solar"
}

Response: {
    "status": "success",
    "data": {
        "yun": 8,  # Váº­n 8 (nÄƒm 1994)
        "base_stars": {
            "0": [{"star": 8, "name": "BÃ¡t Báº¡ch", "ngu_hanh": "Thá»•"}],
            "1": [{"star": 3, "name": "Tam BÃ­ch", "ngu_hanh": "Má»™c"}],
            ...
        },
        "yearly_stars": {...},
        "monthly_stars": {...},
        "combinations": [
            {
                "position": 0,
                "stars": [8, 9],
                "meaning": "TÃ i vÆ°á»£ng - CÃ¡t vá» tÃ i lá»™c"
            }
        ]
    }
}
```

### 6.3. Frontend Components
```javascript
// components/HuyenKhongPanel.js
class HuyenKhongPanel {
    constructor() {
        this.baseStars = null;
        this.yearlyStars = null;
        this.monthlyStars = null;
    }
    
    // Render Phi Tinh lÃªn 12 cung
    renderStars(chartData) {
        // Hiá»ƒn thá»‹ cÃ¡c sao Phi Tinh trÃªn visualization
    }
    
    // Toggle hiá»ƒn thá»‹ cÃ¡c loáº¡i sao
    toggleStarLayer(layerType) {
        // base, yearly, monthly, daily, hourly
    }
    
    // PhÃ¢n tÃ­ch tá»• há»£p
    analyzeCombinations() {
        // PhÃ¢n tÃ­ch cÃ¡c tá»• há»£p Ä‘áº·c biá»‡t
    }
}
```

---

## 7. UI/UX DESIGN

### 7.1. Layout má»›i - Separate Page
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HUYá»€N KHÃ”NG PHI TINH                   [Vá» Tá»­ Vi ChÃ­nh]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nháº­p thÃ´ng tin:                                        â”‚
â”‚ NÄƒm: [____] ThÃ¡ng: [__] NgÃ y: [__] Giá»: [__:__]      â”‚
â”‚ Giá»›i tÃ­nh: â—‹ Nam  â—‹ Ná»¯   Lá»‹ch: â—‹ DÆ°Æ¡ng  â—‹ Ã‚m         â”‚
â”‚                                     [TÃ­nh Phi Tinh]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Há»c phÃ¡i: â¦¿ ÄÃ m DÆ°á»¡ng NgÃ´  â—‹ Tháº©m Thá»‹                â”‚
â”‚                                                        â”‚
â”‚ CÃ¡c táº§ng Phi Tinh:                                     â”‚
â”‚ â˜‘ Váº­n Tinh (20 nÄƒm)        â˜‘ LÆ°u NiÃªn (1 nÄƒm)         â”‚
â”‚ â˜‘ LÆ°u Nguyá»‡t (1 thÃ¡ng)     â˜ LÆ°u Nháº­t (1 ngÃ y) âš ï¸     â”‚
â”‚ â˜ LÆ°u ThÃ¬ (2 giá») âš ï¸âš ï¸                                 â”‚
â”‚                                                        â”‚
â”‚ âš ï¸ Cáº£nh bÃ¡o: LÆ°u Nháº­t vÃ  LÆ°u ThÃ¬ cÃ³ Ä‘á»™ phá»©c táº¡p cao   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  12 CUNG PHI TINH                      â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ Tá»µ   â”‚ Ngá»  â”‚ MÃ¹i  â”‚ ThÃ¢n â”‚  Má»—i cung hiá»ƒn thá»‹:   â”‚
â”‚  â”‚ [7]  â”‚ [6]  â”‚ [2]  â”‚ [4]  â”‚  â€¢ TÃªn cung           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤  â€¢ Sá»‘ sao (1-9)       â”‚
â”‚  â”‚ ThÃ¬n â”‚      â”‚      â”‚ Dáº­u  â”‚  â€¢ MÃ u CÃ¡t/Hung       â”‚
â”‚  â”‚ [8]  â”‚ TRUNGâ”‚      â”‚ [9]  â”‚  â€¢ Icon NgÅ© HÃ nh      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¤      â”‚      â”œâ”€â”€â”€â”€â”€â”€â”¤  â€¢ LÆ°u NiÃªn (náº¿u cÃ³)  â”‚
â”‚  â”‚ MÃ£o  â”‚      â”‚      â”‚ Tuáº¥t â”‚  â€¢ LÆ°u Nguyá»‡t         â”‚
â”‚  â”‚ [3]  â”‚      â”‚      â”‚ [5]  â”‚  â€¢ Tá»• há»£p Ä‘áº·c biá»‡t    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚ Dáº§n  â”‚ Sá»­u  â”‚ TÃ½   â”‚ Há»£i  â”‚                        â”‚
â”‚  â”‚ [1]  â”‚ [6]  â”‚ [7]  â”‚ [8]  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PHÃ‚N TÃCH Tá»” Há»¢P:                                      â”‚
â”‚ â€¢ Cung Má»‡nh (Dáº§n): Sao 1 (Nháº¥t Báº¡ch - Thá»§y) - CÃT     â”‚
â”‚   â†’ TÃ i lá»™c hanh thÃ´ng, trÃ­ tuá»‡ sÃ¡ng suá»‘t             â”‚
â”‚                                                        â”‚
â”‚ â€¢ Cung ThÃ¢n: Sao 2+5 (Nhá»‹ Háº¯c + NgÅ© HoÃ ng) - HUNG     â”‚
â”‚   â†’ âš ï¸ Bá»‡nh PhÃ¹ há»™i, cáº©n tháº­n vá» sá»©c khá»e             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2. Color Scheme
```css
/* CÃ¡t tinh (1, 4, 6, 8, 9) */
.phi-tinh-cat {
    background: linear-gradient(135deg, #4CAF50 0%, #81C784 100%);
    color: white;
}

/* Hung tinh (2, 3, 5, 7) */
.phi-tinh-hung {
    background: linear-gradient(135deg, #F44336 0%, #E57373 100%);
    color: white;
}

/* NgÅ© HoÃ ng - Hung tinh máº¡nh nháº¥t */
.phi-tinh-ngu-hoang {
    background: linear-gradient(135deg, #000000 0%, #424242 100%);
    color: #FFEB3B;
    font-weight: bold;
}
```

### 7.3. Star Display
```html
<div class="phi-tinh-badge phi-tinh-cat">
    <span class="star-number">8</span>
    <span class="star-name">BÃ¡t Báº¡ch</span>
    <span class="ngu-hanh-icon">â›°ï¸</span> <!-- Thá»• -->
</div>
```

---

## 8. IMPLEMENTATION PLAN

### Phase 1: Backend Core Logic (Week 1-2)
- [ ] Create `python/logic/huyen_khong_engine.py`
  - [ ] Implement Váº­n calculation (20-year cycles)
  - [ ] Implement Láº¡c ThÆ° to 12 Cung mapping
  - [ ] Implement fly_stars algorithm (Thuáº­n/Nghá»‹ch phi)
  - [ ] Support both schools: ÄÃ m DÆ°á»¡ng NgÃ´ & Tháº©m Thá»‹
- [ ] Create `python/logic/huyen_khong_liu_calculator.py`
  - [ ] LÆ°u NiÃªn (yearly) calculation
  - [ ] LÆ°u Nguyá»‡t (monthly) calculation
  - [ ] LÆ°u Nháº­t (daily) calculation with Can Chi
  - [ ] LÆ°u ThÃ¬ (hourly) calculation with 12 Giá» Tháº§n
- [ ] Unit tests for all calculations

### Phase 2: Backend API (Week 2)
- [ ] Create `python/graph/blueprints/huyen_khong_bp.py`
- [ ] Create model `HuyenKhongPhiTinh` in `python/core/models.py`
- [ ] API endpoint `POST /api/huyen-khong/calculate`
  - [ ] Input: birth date, gender, school selection
  - [ ] Output: Váº­n, 5 layers of stars, combinations
- [ ] Integration tests with existing calendar_converter

### Phase 3: Frontend New Page (Week 3-4)
- [ ] Create new route `/huyen-khong` in `app.py`
- [ ] Create `python/graph/templates/huyen_khong.html`
  - [ ] Birth date/time input form
  - [ ] School selection toggle (ÄÃ m DÆ°á»¡ng NgÃ´ / Tháº©m Thá»‹)
  - [ ] Time layer checkboxes (5 layers)
  - [ ] Warning messages for LÆ°u Nháº­t/LÆ°u ThÃ¬
- [ ] Create `python/graph/static/js/huyen_khong.js`
  - [ ] Form submission handler
  - [ ] API call to `/api/huyen-khong/calculate`
  - [ ] Render 12 Cung grid with flying stars
  - [ ] Color-coding by CÃ¡t/Hung
  - [ ] Layer toggle functionality

### Phase 4: Visualization & Analysis (Week 4-5)
- [ ] CSS styling for Phi Tinh badges
  - [ ] CÃ¡t tinh: Green gradient
  - [ ] Hung tinh: Red gradient
  - [ ] NgÅ© HoÃ ng: Black/yellow warning style
- [ ] NgÅ© HÃ nh icons (Thá»§y/Má»™c/Há»a/Thá»•/Kim)
- [ ] Special combination detection
  - [ ] 1-4 VÄƒn XÆ°Æ¡ng VÄƒn KhÃºc
  - [ ] 2-5 Bá»‡nh PhÃ¹
  - [ ] 6-7 Kim Kim tranh Ä‘áº¥u
  - [ ] 8-9 TÃ i vÆ°á»£ng
- [ ] Interpretation panel with analysis text

### Phase 5: Testing & Documentation (Week 5-6)
- [ ] E2E tests for full user flow
- [ ] Test both schools produce correct results
- [ ] Test all 5 time layers
- [ ] Performance optimization
- [ ] Write user guide documentation
- [ ] Add help tooltips in UI

**Tá»•ng thá»i gian Æ°á»›c tÃ­nh: 6-7 tuáº§n**

---

## 9. TÃ€I LIá»†U THAM KHáº¢O

### 9.1. LÃ½ thuyáº¿t
- Huyá»n KhÃ´ng Äáº¡i QuÃ¡i (ç„ç©ºå¤§å¦)
- Phi Tinh Äáº©u Sá»‘ (é£›æ˜Ÿæ–—æ•¸)
- Láº¡c ThÆ° Cá»­u Tinh (æ´›æ›¸ä¹æ˜Ÿ)

### 9.2. CÃ´ng thá»©c
```
Váº­n Tinh = ((Year - 1864) / 20) + 1
Thuáº­n Phi: DÆ°Æ¡ng Nam / Ã‚m Ná»¯
Nghá»‹ch Phi: Ã‚m Nam / DÆ°Æ¡ng Ná»¯
```

### 9.3. Test Cases
```python
# Test case 1: NÄƒm 1994, Nam, DÆ°Æ¡ng lá»‹ch
assert get_current_yun(1994) == 8
assert is_yang_year(1994) == True  # GiÃ¡p Tuáº¥t - DÆ°Æ¡ng Má»™c

# Test case 2: NÄƒm 2024, Ná»¯, DÆ°Æ¡ng lá»‹ch
assert get_current_yun(2024) == 9
assert is_yang_year(2024) == True  # GiÃ¡p ThÃ¬n - DÆ°Æ¡ng Má»™c

# Test case 3: Phi tinh sequence
center = 8
yang = True
result = fly_stars(center, yang)
# Expected: 8 á»Ÿ trung tÃ¢m, cÃ¡c sao bay thuáº­n
```

---

## 10. NOTES & CONSIDERATIONS

### 10.1. PhÆ°Æ¡ng phÃ¡p há»c phÃ¡i

**âœ… QUYáº¾T Äá»ŠNH: Implement cáº£ 2 phÃ¡i vá»›i switch toggle**

#### A. ÄÃ m DÆ°á»¡ng NgÃ´ (æ²ˆæ°) - PhÆ°Æ¡ng phÃ¡p phá»• biáº¿n:
- Phi tinh dá»±a vÃ o Ã‚m DÆ°Æ¡ng cá»§a nÄƒm sinh
- Nam DÆ°Æ¡ng/Ná»¯ Ã‚m: Thuáº­n phi (é †é£›)
- Nam Ã‚m/Ná»¯ DÆ°Æ¡ng: Nghá»‹ch phi (é€†é£›)
- Xuáº¥t phÃ¡t tá»« cung Trung tÃ¢m (5)

#### B. Tháº©m Thá»‹ (æ²ˆæ°ç„ç©º) - PhÆ°Æ¡ng phÃ¡p Há»“ng KÃ´ng:
- Phi tinh dá»±a vÃ o hÆ°á»›ng ngá»“i cá»§a nhÃ  (åå‘)
- Phá»©c táº¡p hÆ¡n, cáº§n La BÃ n xÃ¡c Ä‘á»‹nh
- Xuáº¥t phÃ¡t tá»« cung SÆ¡n Tinh/HÆ°á»›ng Tinh
- Káº¿t há»£p vá»›i Äáº¡i Váº­n (20 nÄƒm)

**Implementation:**
```python
class HuyenKhongSchool(Enum):
    DAM_DUONG_NGO = "dam_duong_ngo"  # Default
    THAM_THI = "tham_thi"

# User cÃ³ thá»ƒ switch giá»¯a 2 phÃ¡i trong UI
```

### 10.2. Separate View - Trang riÃªng

**âœ… QUYáº¾T Äá»ŠNH: Táº¡o route má»›i `/huyen-khong` Ä‘á»™c láº­p**

**LÃ½ do:**
- KhÃ´ng lÃ m rá»‘i UI trang chÃ­nh
- Dá»… focus vÃ o Phi Tinh analysis
- Performance tá»‘t hÆ¡n (lazy load)
- CÃ³ thá»ƒ má»Ÿ song song 2 tab Ä‘á»ƒ so sÃ¡nh

**Route structure:**
```
http://localhost:5000/           â†’ Tá»­ Vi truyá»n thá»‘ng (hiá»‡n táº¡i)
http://localhost:5000/huyen-khong â†’ Huyá»n KhÃ´ng Phi Tinh (má»›i)
```

**Navigation:**
```html
<!-- ThÃªm link vÃ o navbar -->
<nav>
  <a href="/">Tá»­ Vi ChÃ­nh</a>
  <a href="/huyen-khong">Huyá»n KhÃ´ng Phi Tinh</a>
</nav>
```

### 10.3. LÆ°u Nháº­t & LÆ°u ThÃ¬ - Bao gá»“m Ä‘áº§y Ä‘á»§

**âœ… QUYáº¾T Äá»ŠNH: Implement Ä‘áº§y Ä‘á»§ 5 táº§ng**

| Táº§ng | TÃªn | Chu ká»³ | Äá»™ phá»©c táº¡p | Status |
|------|-----|--------|-------------|--------|
| 1 | Váº­n Tinh | 20 nÄƒm | â­ Easy | âœ… Phase 1 |
| 2 | LÆ°u NiÃªn | 1 nÄƒm | â­â­ Medium | âœ… Phase 1 |
| 3 | LÆ°u Nguyá»‡t | 1 thÃ¡ng | â­â­â­ Medium | âœ… Phase 2 |
| 4 | LÆ°u Nháº­t | 1 ngÃ y | â­â­â­â­ Hard | âœ… Phase 3 |
| 5 | LÆ°u ThÃ¬ | 2 giá» | â­â­â­â­â­ Very Hard | âœ… Phase 3 |

**Warning system:**
```javascript
// UI sáº½ hiá»ƒn thá»‹ cáº£nh bÃ¡o khi enable LÆ°u Nháº­t/LÆ°u ThÃ¬
if (enableLuuNhat || enableLuuThi) {
    showWarning(
        "âš ï¸ LÆ°u Nháº­t vÃ  LÆ°u ThÃ¬ cÃ³ Ä‘á»™ phá»©c táº¡p cao, " +
        "cÃ³ thá»ƒ cÃ³ sai sá»‘. Chá»‰ dÃ¹ng tham kháº£o."
    );
}
```

### 10.4. Integration vá»›i há»‡ thá»‘ng hiá»‡n táº¡i
- KhÃ´ng conflict vá»›i logic an sao hiá»‡n táº¡i
- CÃ³ thá»ƒ hiá»ƒn thá»‹ song song: Sao truyá»n thá»‘ng + Phi Tinh
- Cáº§n toggle Ä‘á»ƒ chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c cháº¿ Ä‘á»™

### 10.4. Integration vá»›i há»‡ thá»‘ng hiá»‡n táº¡i
- KhÃ´ng conflict vá»›i logic an sao hiá»‡n táº¡i
- Trang riÃªng `/huyen-khong` khÃ´ng áº£nh hÆ°á»Ÿng trang chÃ­nh
- CÃ³ thá»ƒ má»Ÿ 2 tab song song Ä‘á»ƒ so sÃ¡nh

### 10.5. Performance
- Cache Váº­n calculation theo nÄƒm
- Pre-compute Láº¡c ThÆ° mapping
- Lazy load Phi Tinh khi user click "Hiá»ƒn thá»‹ Phi Tinh"

---

## 11. NEXT STEPS

1. **NghiÃªn cá»©u thÃªm:**
   - TÃ¬m tÃ i liá»‡u chÃ­nh xÃ¡c vá» phÃ¡i LÃ­ KhÃ­
   - Consult vá»›i chuyÃªn gia (náº¿u cÃ³)
   - So sÃ¡nh vá»›i cÃ¡c pháº§n má»m Tá»­ Vi khÃ¡c

2. **Prototype:**
   - Build quick prototype Ä‘á»ƒ verify logic
   - Test vá»›i cÃ¡c trÆ°á»ng há»£p cá»¥ thá»ƒ
   - Get feedback tá»« users

3. **Development:**
   - Follow implementation plan
   - Regular testing & validation
   - Iterative improvement

---

## 12. RESOLVED DECISIONS

### âœ… 1. PhÆ°Æ¡ng phÃ¡p Phi Tinh:
**Quyáº¿t Ä‘á»‹nh:** Implement cáº£ 2 phÃ¡i vá»›i toggle switch
- Default: ÄÃ m DÆ°á»¡ng NgÃ´ (phá»• biáº¿n, dá»… dÃ¹ng)
- Option: Tháº©m Thá»‹ (chuyÃªn sÃ¢u hÆ¡n)
- User cÃ³ thá»ƒ chuyá»ƒn Ä‘á»•i trong UI

### âœ… 2. LÆ°u Nháº­t vÃ  LÆ°u ThÃ¬:
**Quyáº¿t Ä‘á»‹nh:** CÃ“ - Implement Ä‘áº§y Ä‘á»§ 5 táº§ng
- Váº­n Tinh, LÆ°u NiÃªn, LÆ°u Nguyá»‡t: Báº¯t buá»™c
- LÆ°u Nháº­t, LÆ°u ThÃ¬: Optional vá»›i warning âš ï¸
- GiÃºp ngÆ°á»i dÃ¹ng tá»± quyáº¿t Ä‘á»‹nh Ä‘á»™ chi tiáº¿t

### âœ… 3. Káº¿t há»£p vá»›i sao truyá»n thá»‘ng:
**Quyáº¿t Ä‘á»‹nh:** KHÃ”NG trong giai Ä‘oáº¡n 1
- TÃ¡ch biá»‡t hoÃ n toÃ n Ä‘á»ƒ trÃ¡nh confusion
- CÃ³ thá»ƒ lÃ m feature tÃ­ch há»£p sau (Phase 7+)

### âœ… 4. UI hiá»ƒn thá»‹:
**Quyáº¿t Ä‘á»‹nh:** Separate view - Trang riÃªng `/huyen-khong`
- KhÃ´ng overlay trÃªn trang chÃ­nh
- Route Ä‘á»™c láº­p: `localhost:5000/huyen-khong`
- LÃ½ do: Clear hÆ¡n, performance tá»‘t hÆ¡n

### âœ… 5. Export/Save:
**Quyáº¿t Ä‘á»‹nh:** CÃ“ - Giai Ä‘oáº¡n sau (Phase 6)
- Export PNG (screenshot)
- Export PDF (formatted report)
- Save to database (user history)
- Share link (generate shareable URL)

## 13. FUTURE ENHANCEMENTS (Phase 7+)

1. **TÃ­ch há»£p sao truyá»n thá»‘ng + Phi Tinh**
   - Combined view showing both systems
   - Cross-reference analysis

2. **LÆ°u lá»‹ch sá»­ tra cá»©u**
   - User account system
   - Save favorite charts
   - Compare multiple charts

3. **Mobile responsive design**
   - Touch-optimized UI
   - Swipe to switch layers

4. **Advanced interpretations**
   - AI-powered analysis
   - Personalized recommendations
   - Life event predictions

5. **Multi-language support**
   - English interface
   - Traditional Chinese option

---

**Document Version:** 2.0  
**Last Updated:** 2024-12-24  
**Author:** AI Assistant  
**Status:** Ready for Implementation
