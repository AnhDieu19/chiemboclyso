<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√¨m Gi·ªù Sinh - T·ª≠ Vi Nam Ph√°i</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/finder.css') }}">
</head>

<body>
    <div class="container-fluid py-4">
        <div style="margin-bottom: 15px;">
            <a href="/" class="btn btn-outline-secondary">üè† V·ªÅ Trang Ch·ªß</a>
        </div>
        <h2 class="text-center mb-4">üîç C√¥ng C·ª• T√¨m Gi·ªù Sinh (Reverse Lookup)</h2>

        <div class="row">
            <!-- Left Panel: Inputs -->
            <div class="col-md-3">
                <div class="card mb-3">
                    <div class="card-header">1. Bi·∫øn ƒê√£ Bi·∫øt (Input)</div>
                    <div class="card-body">
                        <form id="finderForm">
                            <div class="mb-3">
                                <label class="form-label">NƒÉm Sinh</label>
                                <input type="number" class="form-control" name="year" id="year"
                                    placeholder="V√≠ d·ª•: 1996" value="1994" required>
                                <div class="form-check mt-1">
                                    <input class="form-check-input" type="checkbox" id="isSolar" name="isSolar">
                                    <label class="form-check-label small" for="isSolar">
                                        NƒÉm/Th√°ng/Ng√†y l√† D∆∞∆°ng L·ªãch
                                    </label>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label class="form-label" id="lblMonth">Th√°ng (√ÇL)</label>
                                    <select class="form-select" name="month" id="month">
                                        <option value="">(Ch∆∞a bi·∫øt)</option>
                                        {% for i in range(1, 13) %}
                                        <option value="{{ i }}" {% if i==2 %}selected{% endif %}>Th√°ng {{ i }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-6 mb-3">
                                    <label class="form-label" id="lblDay">Ng√†y (√ÇL)</label>
                                    <select class="form-select" name="day" id="day">
                                        <option value="">(Ch∆∞a bi·∫øt)</option>
                                        {% for i in range(1, 32) %}
                                        <option value="{{ i }}">Ng√†y {{ i }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Gi·ªù Sinh (N·∫øu bi·∫øt)</label>
                                <select class="form-select" name="birthHour" id="birthHour">
                                    <option value="-1" selected>-- Ch∆∞a bi·∫øt --</option>
                                    {% for h in hours %}
                                    <option value="{{ h.id }}">{{ h.name }} ({{ h.range }})</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Gi·ªõi T√≠nh</label>
                                <select class="form-select" name="gender" id="gender">
                                    <option value="nam" selected>Nam</option>
                                    <option value="nu">N·ªØ</option>
                                </select>
                            </div>

                            <hr>
                            <label class="form-label fw-bold">ƒê·∫∑c ƒêi·ªÉm & S·ª± Ki·ªán</label>

                            <!-- Traits -->
                            <div class="mb-2">
                                <label class="small text-muted">T√≠nh C√°ch</label>
                                <select class="form-control trait-select" multiple>
                                    {% for item in options.traits %}
                                    <option value="{{ item }}">{{ item }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Events (Dynamic) -->
                            <div class="mb-2">
                                <label class="small text-muted">S·ª± Ki·ªán Quan Tr·ªçng</label>
                                <div id="eventsContainer">
                                    <!-- Dynamic rows go here -->
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-secondary mt-1 w-100"
                                    id="btnAddEvent">
                                    + Th√™m s·ª± ki·ªán (NƒÉm)
                                </button>
                            </div>

                            <!-- Profession -->
                            <div class="mb-2">
                                <label class="small text-muted">Ngh·ªÅ Nghi·ªáp</label>
                                <select class="form-control trait-select" multiple>
                                    {% for item in options.profession %}
                                    <option value="{{ item }}">{{ item }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Appearance -->
                            <div class="mb-2">
                                <label class="small text-muted">Ngo·∫°i H√¨nh</label>
                                <select class="form-control trait-select" multiple>
                                    {% for item in options.appearance %}
                                    <option value="{{ item }}">{{ item }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="d-grid mt-3">
                                <button type="submit" class="btn btn-primary" id="btnSearch">üöÄ T√¨m Ki·∫øm L√° S·ªë</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Panel: SLOT MACHINE UI -->
            <div class="col-md-9">
                <!-- RANKING HEADER -->
                <div class="row mb-3" id="leaderboardSection" style="display:none;">
                    <div class="col-12">
                        <div class="card bg-warning bg-opacity-10 border-warning">
                            <div class="card-body">
                                <h5 class="card-title text-warning-emphasis">üèÜ Top 3 L√° S·ªë "Th√†nh C√¥ng Nh·∫•t" (Success
                                    Ranking)</h5>
                                <div class="row" id="topRankContainer">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>2. ·ªî Kh√≥a S·ªë (Combination Lock)</span>
                        <div>
                            <span class="badge bg-light text-dark me-2" id="resultCount">0 candidates</span>
                            <button class="btn btn-sm btn-success" id="btnAutoSnap" style="display:none;">‚ö° T√¨m kh·ªõp
                                nh·∫•t (Best Fit)</button>
                        </div>
                    </div>
                    <div class="card-body bg-light">

                        <!-- Initial Placeholder -->
                        <div id="initialState" class="text-center py-5 text-muted">
                            <h4>üéØ Vui l√≤ng nh·∫≠p th√¥ng tin v√† b·∫•m t√¨m ki·∫øm</h4>
                            <p>Giao di·ªán "·ªî Kh√≥a S·ªë" s·∫Ω hi·ªán ra t·∫°i ƒë√¢y.</p>
                        </div>

                        <!-- THE SLOT MACHINE -->
                        <div id="slotMachine" class="slot-machine-wrapper" style="display:none;">

                            <!-- REELS (Inputs) -->
                            <div class="reels-container">
                                <div class="focus-bar"></div>

                                <!-- YEAR REEL (Fixed usually) -->
                                <div class="reel" id="reelYear">
                                    <div class="reel-spacer"></div>
                                    <!-- Dynamic Items -->
                                    <div class="reel-spacer"></div>
                                </div>

                                <!-- MONTH REEL -->
                                <div class="reel" id="reelMonth">
                                    <div class="reel-spacer"></div>
                                    <!-- Dynamic Items -->
                                    <div class="reel-spacer"></div>
                                </div>

                                <!-- DAY REEL -->
                                <div class="reel" id="reelDay">
                                    <div class="reel-spacer"></div>
                                    <!-- Dynamic Items -->
                                    <div class="reel-spacer"></div>
                                </div>

                                <!-- HOUR REEL -->
                                <div class="reel" id="reelHour">
                                    <div class="reel-spacer"></div>
                                    <!-- Dynamic Items -->
                                    <div class="reel-spacer"></div>
                                </div>
                            </div>

                            <!-- RESULT PANEL (Outputs) -->
                            <div class="result-panel pl-4">
                                <div class="mb-3">
                                    <small class="text-muted text-uppercase fw-bold">ƒêi·ªÉm Kh·ªõp (Score)</small>
                                    <div id="scoreDisplay" class="score-display">-- / --</div>
                                </div>

                                <div id="cungMenhBox" class="cung-menh-box">
                                    <strong>Cung M·ªánh:</strong> <span id="menhContent">--</span>
                                </div>

                                <div class="mb-3">
                                    <h6>L√Ω Do Kh·ªõp (Details):</h6>
                                    <ul id="matchDetailsList" class="list-group list-group-flush">
                                        <li class="list-group-item bg-transparent text-muted small">Ch∆∞a c√≥ d·ªØ li·ªáu...
                                        </li>
                                    </ul>
                                </div>

                                <hr>
                                <div class="mb-3">
                                    <h6>üìà Bi·ªÉu ƒê·ªì Th·ªùi V·∫≠n (Cu·ªôc ƒê·ªùi)</h6>
                                    <div style="height: 200px;">
                                        <canvas id="lifeChart"></canvas>
                                    </div>
                                    <p class="text-muted small mt-1 text-center font-italic">D·ª± b√°o di·ªÖn bi·∫øn th·ªãnh suy
                                        t·ª´ 20 - 80 tu·ªïi</p>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <!-- Jinja2 server-side data bridge -->
    <script>
        EVENT_OPTIONS = [
            {% for item in options.events %}
            "{{ item }}",
            {% endfor %}
        ];
    </script>
    <script src="{{ url_for('static', filename='js/finder.js') }}"></script>
</body>

</html>