<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ª≠ Vi ƒê·∫©u S·ªë - Python Application</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chart.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
</head>

<body>
    <div class="container">
        <h1>üîÆ T·ª¨ VI ƒê·∫®U S·ªê</h1>
        <div class="home-button-container">
            <a href="/finder" class="btn-calculate btn-home-link btn-gradient-blue">üîç
                T√¨m Gi·ªù Sinh (Ng∆∞·ª£c)</a>
            <a href="/analytics/beauty" class="btn-calculate btn-home-link btn-gradient-orange">üìä
                Th·ªëng K√™ H·ªìng Nhan</a>
            <a href="/vdp/" class="btn-calculate btn-home-link btn-gradient-green">üï∏Ô∏è
                Vi Di·ªáu Ph√°p</a>
        </div>
        <div class="form-section">
            <div class="calendar-toggle"> <button id="btnSolar" class="active" onclick="setCalendarMode('solar')">‚òÄÔ∏è
                    D∆∞∆°ng L·ªãch</button> <button id="btnLunar" onclick="setCalendarMode('lunar')">üåô √Çm L·ªãch</button>
            </div>
            <form id="birthForm">
                <div class="form-grid">
                    <div class="form-group"> <label id="dayLabel">Ng√†y</label> <input type="number" id="day" min="1"
                            max="31" value="28"> </div>
                    <div class="form-group"> <label id="monthLabel">Th√°ng</label> <input type="number" id="month"
                            min="1" max="12" value="3"> </div>
                    <div class="form-group"> <label>NƒÉm</label> <input type="number" id="year" min="1900" max="2100"
                            value="1994" required> </div>
                    <div class="form-group"> <label>Gi·ªù sinh</label> <select id="hour">
                            <option value="">(Kh√¥ng bi·∫øt)</option>
                            <option value="0">T√Ω (23-01h)</option>
                            <option value="2">S·ª≠u (01-03h)</option>
                            <option value="4">D·∫ßn (03-05h)</option>
                            <option value="6">M√£o (05-07h)</option>
                            <option value="8">Th√¨n (07-09h)</option>
                            <option value="10">T·ªµ (09-11h)</option>
                            <option value="12" selected>Ng·ªç (11-13h)</option>
                            <option value="14">M√πi (13-15h)</option>
                            <option value="16">Th√¢n (15-17h)</option>
                            <option value="18">D·∫≠u (17-19h)</option>
                            <option value="20">Tu·∫•t (19-21h)</option>
                            <option value="22">H·ª£i (21-23h)</option>
                        </select> </div>
                    <div class="form-group"> <label>Gi·ªõi t√≠nh</label> <select id="gender">
                            <option value="nam">Nam</option>
                            <option value="nu">N·ªØ</option>
                        </select> </div>
                    <div class="form-group leap-month" id="leapMonth"> <label>Th√°ng nhu·∫≠n</label> <input type="checkbox"
                            id="leapMonthCheck"> </div>
                </div> <button type="submit" class="btn-calculate">üîÆ L·∫•y L√° S·ªë</button>
            </form>
        </div>
        <div class="loading" id="loading">
            <p>ƒêang t√≠nh to√°n l√° s·ªë...</p>
        </div>

        <!-- NEW ANALYTICS SECTION -->
        <div class="analytics-dashboard" style="margin-top: 40px; background: #fff; padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 25px; font-size: 1.8rem;">üìä Ph√¢n T√≠ch D·ªØ Li·ªáu L·ªõn (500k L√° S·ªë)</h2>
            
            <div class="analytics-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Chart 1: Heatmap -->
                <div class="analytics-card" style="border: 1px solid #eee; padding: 15px; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: #34495e;">1. Th·ªùi ƒêi·ªÉm V√†ng (Gi·ªù vs Th√°ng)</h3>
                    <img src="{{ url_for('static', filename='images/analytics/1_destiny_heatmap.png') }}" style="width: 100%; border-radius: 8px;" alt="Heatmap">
                    <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 8px;">Gi·ªù T√Ω (23h-1h) c√≥ ch·ªâ s·ªë h·∫°nh ph√∫c cao nh·∫•t.</p>
                </div>

                <!-- Chart 2: Stars -->
                <div class="analytics-card" style="border: 1px solid #eee; padding: 15px; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: #34495e;">2. X·∫øp H·∫°ng Ch√≠nh Tinh</h3>
                    <img src="{{ url_for('static', filename='images/analytics/2_star_power_ranking.png') }}" style="width: 100%; border-radius: 8px;" alt="Star Ranking">
                    <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 8px;">Top c√°c sao mang l·∫°i cu·ªôc s·ªëng thu·∫≠n l·ª£i nh·∫•t.</p>
                </div>

                <!-- Chart 5: Ban Menh -->
                <div class="analytics-card" style="border: 1px solid #eee; padding: 15px; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: #34495e;">3. T∆∞∆°ng Quan Ng≈© H√†nh</h3>
                    <img src="{{ url_for('static', filename='images/analytics/5_ban_menh_correlation.png') }}" style="width: 100%; border-radius: 8px;" alt="Ban Menh">
                    <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 8px;">Ph√¢n ph·ªëi ch·ªâ s·ªë h·∫°nh ph√∫c theo B·∫£n M·ªánh.</p>
                </div>

                <!-- Chart 3: Generation -->
                <div class="analytics-card" style="border: 1px solid #eee; padding: 15px; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: #34495e;">4. Xu H∆∞·ªõng Th·ªùi ƒê·∫°i</h3>
                    <img src="{{ url_for('static', filename='images/analytics/3_generation_gap.png') }}" style="width: 100%; border-radius: 8px;" alt="Generation Gap">
                    <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 8px;">Bi·∫øn ƒë·ªông ch·ªâ s·ªë Life Index qua c√°c nƒÉm (1950-2005).</p>
                </div>

                <!-- Chart 4: Distribution -->
                <div class="analytics-card" style="border: 1px solid #eee; padding: 15px; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px; color: #34495e;">5. Ph√¢n Ph·ªëi May M·∫Øn</h3>
                    <img src="{{ url_for('static', filename='images/analytics/4_luck_distribution.png') }}" style="width: 100%; border-radius: 8px;" alt="Distribution">
                    <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 8px;">Ph·∫ßn l·ªõn m·ªçi ng∆∞·ªùi ƒë·ªÅu c√≥ ch·ªâ s·ªë c√¢n b·∫±ng (Bell Curve).</p>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #e74c3c;">
                <strong>‚ö†Ô∏è Ph√°t hi·ªán quan tr·ªçng:</strong> 
                L√° s·ªë c√≥ <em>ƒê·ªãa Kh√¥ng</em> t·∫°i M·ªánh th∆∞·ªùng c√≥ ch·ªâ s·ªë th·∫•p h∆°n trung b√¨nh (-0.86 ƒëi·ªÉm). 
                Tuy nhi√™n, Tu·∫ßn/Tri·ªát l·∫°i c√≥ xu h∆∞·ªõng ·ªïn ƒë·ªãnh m·ªánh s·ªë t√≠ch c·ª±c.
            </div>
        </div>
        <div id="results">
            <div class="chart-container">
                <div class="chart-grid" id="chartGrid"> <!-- Will be populated by JavaScript --> </div>
            </div>
            <div class="interpretation" id="interpretation"> <!-- Interpretation will be added here --> </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/chart-renderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/interpretation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/form-handler.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ai-chat.js') }}"></script>
    <!-- Reverse Lookup Modal -->
    <div id="reverseLookupModal" class="modal">
        <div class="modal-content reverse-modal-content"> <span class="close">&times;</span>
            <h2>Tra C·ª©u Ng∆∞·ª£c (T√¨m Ng√†y Sinh t·ª´ Sao)</h2>
            <div class="reverse-container"> <!-- Left: Star Selection -->
                <div class="reverse-col">
                    <h3>1. Ch·ªçn Sao v√† Cung</h3>
                    <div class="form-group"> <label>Sao mu·ªën t√¨m:</label> <select id="revStarSelect"
                            class="form-control">
                            <option value="T·ª≠ Vi">T·ª≠ Vi</option>
                            <option value="L·ªôc T·ªìn">L·ªôc T·ªìn</option>
                            <option value="Th√°i Tu·∫ø">Th√°i Tu·∫ø</option>
                            <option value="Thi√™n M√£">Thi√™n M√£</option>
                            <option value="T·∫£ Ph·ª•">T·∫£ Ph·ª•</option>
                            <option value="H·ªØu B·∫≠t">H·ªØu B·∫≠t</option>
                            <option value="VƒÉn X∆∞∆°ng">VƒÉn X∆∞∆°ng</option>
                            <option value="VƒÉn Kh√∫c">VƒÉn Kh√∫c</option>
                            <option value="Kinh D∆∞∆°ng">Kinh D∆∞∆°ng</option>
                            <option value="ƒê√† La">ƒê√† La</option>
                            <option value="Thi√™n Kh√¥i">Thi√™n Kh√¥i</option>
                            <option value="Thi√™n Vi·ªát">Thi√™n Vi·ªát</option>
                        </select> </div>
                    <div class="form-group"> <label>ƒê·∫∑t t·∫°i Cung:</label> <select id="revPalaceSelect"
                            class="form-control">
                            <option value="0">T√Ω</option>
                            <option value="1">S·ª≠u</option>
                            <option value="2">D·∫ßn</option>
                            <option value="3">M√£o</option>
                            <option value="4">Th√¨n</option>
                            <option value="5">T·ªµ</option>
                            <option value="6">Ng·ªç</option>
                            <option value="7">M√πi</option>
                            <option value="8">Th√¢n</option>
                            <option value="9">D·∫≠u</option>
                            <option value="10">Tu·∫•t</option>
                            <option value="11">H·ª£i</option>
                        </select> </div> <button onclick="addConstraint()" class="btn-primary" style="width:100%">Th√™m
                        ƒêi·ªÅu Ki·ªán</button>
                    <h3 style="margin-top: 20px;">2. ƒêi·ªÅu ki·ªán ƒë√£ ch·ªçn</h3>
                    <ul id="constraintList" class="constraint-list"></ul>
                    <button onclick="searchDates()" class="btn-primary btn-search-dates">T√¨m Ng√†y Sinh</button>
                </div> <!-- Right: Results -->
                <div class="reverse-col">
                    <h3>3. K·∫øt qu·∫£ T√¨m ki·∫øm</h3>
                    <div id="searchResults" class="search-results-box">
                        <div class="search-results-placeholder">K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>

    <!-- AI Master Modal -->
    <div id="aiModal" class="modal" style="display:none">
        <div class="modal-content ai-modal-content">
            <!-- Header -->
            <div class="ai-header">
                <span onclick="closeAIModal()" class="ai-close-btn">&times;</span>
                <div class="ai-header-flex">
                    <div class="ai-avatar">üßô‚Äç‚ôÇÔ∏è</div>
                    <div>
                        <h2 class="ai-title">Th·∫ßy T·ª≠ Vi AI</h2>
                        <p class="ai-subtitle">50 nƒÉm kinh nghi·ªám - Nam Ph√°i</p>
                    </div>
                </div>
            </div>

            <!-- Quick Action -->
            <div class="ai-quick-action">
                <button onclick="askAIFull()" class="ai-btn-full">
                    üîÆ Xin Th·∫ßy Lu·∫≠n Gi·∫£i To√†n B·ªô L√° S·ªë
                </button>
            </div>

            <!-- Chat Messages -->
            <div id="aiChatMessages" class="ai-chat-messages">
                <div class="ai-welcome-box">
                    <div class="ai-welcome-icon">üßô‚Äç‚ôÇÔ∏è</div>
                    <p>Xin ch√†o! T√¥i l√† th·∫ßy t·ª≠ vi AI v·ªõi 50 nƒÉm kinh nghi·ªám.</p>
                    <p class="ai-welcome-hint">Nh·∫•n "Xin Th·∫ßy Lu·∫≠n Gi·∫£i" ƒë·ªÉ t√¥i xem l√° s·ªë c·ªßa b·∫°n,<br>ho·∫∑c g√µ c√¢u h·ªèi
                        v√†o
                        √¥ b√™n d∆∞·ªõi.</p>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="ai-input-area">
                <input type="text" id="aiChatInput" placeholder="H·ªèi th·∫ßy v·ªÅ l√° s·ªë c·ªßa b·∫°n..." class="ai-chat-input">
                <button onclick="sendChatMessage()" class="ai-send-btn">
                    G·ª≠i
                </button>
            </div>
        </div>
    </div>
</body>

</html>